{"version":3,"file":"router.js","sources":["../../src/router.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { captureException } from '@sentry/browser';\nimport { Transaction, TransactionContext } from '@sentry/types';\n\nexport type VueRouterInstrumentation = <T extends Transaction>(\n  startTransaction: (context: TransactionContext) => T | undefined,\n  startTransactionOnPageLoad?: boolean,\n  startTransactionOnLocationChange?: boolean,\n) => void;\n\n// This is not great, but kinda necessary to make it work with VueRouter@3 and VueRouter@4 at the same time.\ntype Route = {\n  params: any;\n  query: any;\n  name?: any;\n  path: any;\n  matched: any[];\n};\ninterface VueRouter {\n  onError: (fn: (err: Error) => void) => void;\n  beforeEach: (fn: (to: Route, from: Route, next: () => void) => void) => void;\n}\n\n/**\n * Creates routing instrumentation for Vue Router v2\n *\n * @param router The Vue Router instance that is used\n */\nexport function vueRouterInstrumentation(router: VueRouter): VueRouterInstrumentation {\n  return (\n    startTransaction: (context: TransactionContext) => Transaction | undefined,\n    startTransactionOnPageLoad: boolean = true,\n    startTransactionOnLocationChange: boolean = true,\n  ) => {\n    router.onError(error => captureException(error));\n\n    router.beforeEach((to, from, next) => {\n      // According to docs we could use `from === VueRouter.START_LOCATION` but I couldnt get it working for Vue 2\n      // https://router.vuejs.org/api/#router-start-location\n      // https://next.router.vuejs.org/api/#start-location\n\n      // Vue2 - null\n      // Vue3 - undefined\n      const isPageLoadNavigation = from.name == null && from.matched.length === 0;\n\n      const tags = {\n        'routing.instrumentation': 'vue-router',\n      };\n      const data = {\n        params: to.params,\n        query: to.query,\n      };\n\n      if (startTransactionOnPageLoad && isPageLoadNavigation) {\n        startTransaction({\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n          name: (to.name && to.name.toString()) || to.path,\n          op: 'pageload',\n          tags,\n          data,\n        });\n      }\n\n      if (startTransactionOnLocationChange && !isPageLoadNavigation) {\n        startTransaction({\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n          name: (to.name && to.name.toString()) || (to.matched[0] && to.matched[0].path) || to.path,\n          op: 'navigation',\n          tags,\n          data,\n        });\n      }\n\n      next();\n    });\n  };\n}\n"],"names":[],"mappings":";;;;AAuBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;"}