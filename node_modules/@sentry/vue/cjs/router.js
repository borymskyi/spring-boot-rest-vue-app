Object.defineProperty(exports, '__esModule', { value: true });

var browser = require('@sentry/browser');

/**
 * Creates routing instrumentation for Vue Router v2
 *
 * @param router The Vue Router instance that is used
 */
function vueRouterInstrumentation(router) {
  return (
    startTransaction,
    startTransactionOnPageLoad = true,
    startTransactionOnLocationChange = true,
  ) => {
    router.onError(error => browser.captureException(error));

    router.beforeEach((to, from, next) => {
      // According to docs we could use `from === VueRouter.START_LOCATION` but I couldnt get it working for Vue 2
      // https://router.vuejs.org/api/#router-start-location
      // https://next.router.vuejs.org/api/#start-location

      // Vue2 - null
      // Vue3 - undefined
      var isPageLoadNavigation = from.name == null && from.matched.length === 0;

      var tags = {
        'routing.instrumentation': 'vue-router',
      };
      var data = {
        params: to.params,
        query: to.query,
      };

      if (startTransactionOnPageLoad && isPageLoadNavigation) {
        startTransaction({
                    name: (to.name && to.name.toString()) || to.path,
          op: 'pageload',
          tags,
          data,
        });
      }

      if (startTransactionOnLocationChange && !isPageLoadNavigation) {
        startTransaction({
                    name: (to.name && to.name.toString()) || (to.matched[0] && to.matched[0].path) || to.path,
          op: 'navigation',
          tags,
          data,
        });
      }

      next();
    });
  };
}

exports.vueRouterInstrumentation = vueRouterInstrumentation;
//# sourceMappingURL=router.js.map
